<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="My notes from #djangocon 🦀 day 1."><meta name=keywords content><link rel=canonical href=https://www.djpeacher.com/posts/djangocon-us-22-day-1/><link rel=stylesheet href=https://cdn.simplecss.org/simple.min.css><link rel=stylesheet href=/css/simple-plus.css><link rel=stylesheet href=/css/custom.css><link rel=icon type=image/png sizes=32x32 href=/img/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon-16x16.png><title>DjangoCon US 2022: Day 1 | Jonathan Peacher</title><style>:root{--bg:#fff;--accent-bg:#f5f5f5;--text:#212121;--text-light:#585858;--border:#d8dae1;--accent:#212121;--code:#d81b60;--preformatted:#444;--marked:#ffdd33;--disabled:#efefef}@media(prefers-color-scheme:dark){:root{--bg:#212121;--accent-bg:#2b2b2b;--text:#dcdcdc;--text-light:#ababab;--border:#666;--accent:#809fff;--code:#f06292;--preformatted:#ccc;--marked:#ffdd33;--disabled:#111}}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/SebastianAigner/twemoji-amazing@1.0.0/twemoji-amazing.css><link rel=alternate type=application/rss+xml href=/posts/index.xml title="Jonathan Peacher"><link rel=me href=https://fosstodon.org/@djpeacher><script src=https://cdn.usefathom.com/script.js data-site=KFUFSJGY defer></script></head><body><header><nav></nav><h1>DjangoCon US 2022: Day 1</h1><p>My notes from #djangocon 🦀 day 1.</p><time datetime=221017>221017</time></header><main><h2 id=the-django-admin-is-your-oyster-lets-extend-its-functionalityhttps2022djangoconustalksthe-django-admin-is-your-oyster-lets-its><a href=https://2022.djangocon.us/talks/the-django-admin-is-your-oyster-lets-its/>The Django Admin Is Your Oyster: Let’s Extend Its Functionality</a></h2><ul><li><p>Don&rsquo;t make it easy for attackers to find your admin page&mldr;don&rsquo;t use <code>/admin</code>.</p></li><li><p>Override <code>ModelAdmin.get_search_results</code> to speed up searching.</p></li><li><p>Remember to use <code>prefetch_related</code> and <code>select_related</code> to reduce DB queries.</p></li><li><p>Add optional checkboxes to change forms to kickoff extra functions when saved.</p><ul><li>You can also dynamically set help text for better UX.</li></ul></li><li><p>You can use multiple databases in a single admin.</p><pre tabindex=0><code># Migrate
$ python manage.py --database=sandbox

# settings.py
DATABASES = {
  &#39;default&#39;: {...},
  &#39;sandbox&#39;: {...}
}

# utils.py
class SandboxAdminModel(admin.ModelAdmin):
  using = &#39;sandbox&#39;

  def save_model(self, request, obj, form, change):
      obj.save(using=self.using)

  def delete_model(self, request, obj):
      obj.delete(using=self.using)

  def get_queryset(self, request):
      return super().get_queryset(request).using(self.using)

# admin.py
@admin.register(MySandboxModel)
class MySandboxModelAdmin(SandboxModelAdmin):
  ...
</code></pre></li><li><p>Extend <code>change_form.html</code> to add help text for the whole model, not just fields.</p><pre tabindex=0><code># change_form.html
{% extends &#34;admin/change_form.html&#34; %}

{% block form_top %}
  {{ original.admin_help_text }}
{% endblock %}

# models.py
class MyModel(models.Model):
  admin_help_text = &#34;...&#34;
</code></pre></li><li><p>Create custom actions for bulk changes.</p><pre tabindex=0><code># admin.py
def increase_msrp_by_8_perc(modeladmin, request, queryset):
  ...

@admin.register(Car)
class CarAdmin(admin.ModelAdmin):
  actions = [increase_msrp_by_8_perc]
</code></pre></li></ul><h2 id=documenting-django-code-in-2022https2022djangoconustalksdocumenting-django-code-in-2022><a href=https://2022.djangocon.us/talks/documenting-django-code-in-2022/>Documenting Django Code in 2022</a></h2><ul><li><a href=https://diataxis.fr>https://diataxis.fr</a>: A framework for authoring technical documentation.</li></ul><h2 id=you-dont-need-containers-to-run-django-in-productionhttps2022djangoconustalksyou-don-t-need-containers-to-run-django><a href=https://2022.djangocon.us/talks/you-don-t-need-containers-to-run-django/>You Don&rsquo;t Need Containers to Run Django in Production</a></h2><ul><li>When <strong>should</strong> you use containers? When you have&mldr;<ul><li>Thousands of programmers.</li><li>Millions of users.</li><li>Billions in valuation.</li></ul></li><li>There is a lot of FOMO around containers. For example, reproducibility is a big selling point for containers, but generally, this benefit is rarely taken advantage of.</li><li>Some downsides of using containers are added <a href=https://landscape.cncf.io>complexity</a> and cost.</li><li>What do we want in production?<ul><li>Secure environment.</li><li>Protection against malicious users.</li><li>Don&rsquo;t want to wake up in the middle of the night.</li><li>Seamless code updates.</li></ul></li><li>Web Server (WSGI vs ASGI):<ul><li>WSGI is 20 years old&mldr;and it shows.<ul><li>Limited concurrency.</li><li>Graphic: <em>Showed that as clients scale with <code>gunicorn</code>, response time gets worse. The graph represented a BEST case scenario.</em></li></ul></li><li>ASGI is 5 years old&mldr;and it shows.<ul><li>Unlimited concurrency (ignoring memory).</li><li>Graphic: <em>Showed that as clients scale with <code>uvicorn</code>, response time gets worse. The graph represented a WORST case scenario.</em></li></ul></li></ul></li><li>Reverse Proxy (nginx):<ul><li>Can help limit concurrency as needed.</li><li>nginx can handle 20 million RPM on a 8 core VM.</li><li>Caddy is a new/easier alternative, but nginx is tried and tested.</li></ul></li><li>Process Monitor (SystemD)</li><li>Deployment (Git Deploy Config)</li><li>Bonus Tip: Use software that offers LTS.</li></ul><h1 id=herding-your-database-queries-diagnosing-improving-and-guarding-performance-of-db-interactions-in-your-django-appshttps2022djangoconustalksherding-your-database-queries-diagnosing><a href=https://2022.djangocon.us/talks/herding-your-database-queries-diagnosing/>Herding your database queries: diagnosing, improving and guarding performance of DB interactions in your Django apps</a></h1><ul><li><p><a href=https://engineering.pathai.com/herding-your-database-queries-in-django>Blog Post</a></p></li><li><p>Tools like <code>django-debug-toolbar</code> and <code>django-silk</code> are great for diagnosing rogue queries, but there can be cases where these tools are not going to help directly (e.g. with a js frontend).</p></li><li><p>To solve this, they rolled their own <a href=https://github.com/Path-AI/django-request-stats-example/blob/main/req_stats/middleware.py>custom middleware</a> to analyze queries per request and output the result to the terminal.</p><pre tabindex=0><code>Received request GET /library/books/, status 200, db_query_count=29, db_query_time_ms=136.421, duration_ms=192.56
</code></pre></li><li><p>After you optimize your queries, you can protect yourself from regression with unit tests by taking advantage of <a href=https://pytest-django.readthedocs.io/en/latest/helpers.html#django-assert-max-num-queries>django_assert_max_num_queries</a>.</p></li><li><p>You can also use <a href=https://coverage.readthedocs.io/en/6.4.3/contexts.html>coverage context</a> to check new endpoints that are created and don&rsquo;t have unit tests.</p></li></ul><h2 id=the-django-jigsaw-puzzle-aligning-all-the-pieceshttps2022djangoconustalksthe-django-jigsaw-puzzle-aligning-all><a href=https://2022.djangocon.us/talks/the-django-jigsaw-puzzle-aligning-all/>The Django Jigsaw Puzzle: Aligning All the Pieces</a></h2><ul><li>(other) MVC == MVT (django)<ul><li>Model == Model</li><li>View == Template</li><li>Controller == View</li></ul></li><li>The Django Admin is great, but if your <code>admin.py</code> is growing past 20 lines, you might be relying on it too much.</li><li><code>django-extensions</code>: One of the things it does is auto import models in the django shell.</li><li>Don&rsquo;t use <code>/admin</code>!</li></ul><pre tabindex=0><code>                                        WSGI Server
                                        ┌────────────────────────────────────────────────┐
                                        │ Middlware                                      │
                                        │ ┌────────────────────────────────────────────┐ │
                                        │ │ Django app                                 │ │
         HTTP request                   │ │ ┌────────────────────────────────────────┐ │ │
        ─────────────► ┌──────────┐ ──► │ │ │ ┌────────┐     ┌─────┐     ┌──────┐    │ │ │   ┌─────────┐
Browser                │Web Server│     │ │ │ │URL conf│ ──► │     │ ─── │Models│ ───┼─┼─┼── │Databases│
        ◄───────────── └──────────┘ ◄── │ │ │ └────────┘     │     │     └──────┘    │ │ │   └─────────┘
         HTTP response      ▲           │ │ │                │Views│                 │ │ │
                            │           │ │ │                │     │     ┌─────────┐ │ │ │
                            ▼           │ │ │                │     │ ─── │Templates│ │ │ │
                         ┌──────┐       │ │ │                └─────┘     └─────────┘ │ │ │
                         │ File │       │ │ └────────────────────────────────────────┘ │ │
                         │System│       │ └────────────────────────────────────────────┘ │
                         └──────┘       └────────────────────────────────────────────────┘
</code></pre><h2 id=nurturing-a-legacy-codebasehttps2022djangoconustalksnurturing-a-legacy-codebase><a href=https://2022.djangocon.us/talks/nurturing-a-legacy-codebase/>Nurturing a &ldquo;Legacy&rdquo; Codebase</a></h2><ul><li>What is a &ldquo;legacy&rdquo; codebase?<ul><li>Code with, potentially forgotten, history.</li><li>Code that follow outdated conventions.</li><li>Usually still running in production.</li></ul></li><li>Should you evolve or rebuild? Ask yourself&mldr;<ul><li>Does the code meet current requirements?</li><li>Are there frequent or sever production issues?</li><li>How healthy are the dependencies?</li></ul></li><li>Lets say you choose &ldquo;evolve,&rdquo; what should you do?<ul><li>Automated tests with good coverage.</li><li>Upgrade/Replace outdated dependencies.</li><li>Use a linter and/or <code>black</code> for code formatting.</li><li>Use <code>pre-commit</code> for cross-team consistency.</li><li>Make sure current devs understand the story of the code.</li><li>Help future devs by writing detailed commit messages along with an issue tracker.</li><li>Document!</li><li>Build a culture of leaving clues for the future!</li></ul></li></ul><a class="button replyButton" href="mailto: reply@djpeacher.com?subject=RE: DjangoCon%20US%202022%3a%20Day%201">Reply via email</a></main></body></html>